// MIT license
// (c) 2016 #NVJOB Nicholas Veselov - https://nvjob.github.io
// #NVJOB Simple Pool v1.2 - https://nvjob.github.io/unity/nvjob-simple-pool.html


using UnityEngine;
using System.Collections.Generic;


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


public class SimplePool : MonoBehaviour
{
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    public List<ObjectsPool> ObjectsList = new List<ObjectsPool>();

    //--------------

    static Transform stThisTransform;
    static int[] stNumberObjects;
    static GameObject[][] stObjects;
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    private void Awake()
    {
        //--------------

        stThisTransform = transform;
        AddObjectsToPool();

        //--------------
    }
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    private void AddObjectsToPool()
    {
        //--------------

        stNumberObjects = new int[ObjectsList.Count];
        stObjects = new GameObject[ObjectsList.Count][];

        //--------------

        for (int num = 0; num < ObjectsList.Count; num++)
        {
            stNumberObjects[num] = ObjectsList[num].numberObjects;
            stObjects[num] = new GameObject[stNumberObjects[num]];
            InstanInPool(ObjectsList[num].obj, stObjects[num]);
        }

        //--------------
    }
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    static private void InstanInPool(GameObject obj, GameObject[] objs)
    {
        //--------------

        for (int i = 0; i < objs.Length; i++)
        {
            objs[i] = Instantiate(obj);
            objs[i].SetActive(false);
            objs[i].transform.parent = stThisTransform;
        }

        //--------------
    }
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    static public GameObject GiveObj(int num)
    {
        //--------------

        for (int i = 0; i < stNumberObjects[num]; i++) if (!stObjects[num][i].activeSelf) return stObjects[num][i];
        return null;

        //--------------
    }
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    static public void Takeobj(GameObject obj)
    {
        //--------------

        obj.SetActive(false);
        if (obj.transform.parent != stThisTransform) obj.transform.parent = stThisTransform;

        //--------------
    }


    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


[System.Serializable]

public class ObjectsPool
{
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    public GameObject obj;
    public int numberObjects = 100;
    

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}